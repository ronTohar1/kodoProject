import json
import requests

api_key = "7e8fa83574d0a78b37b37daa819f6069"

url = "https://mb-api.abuse.ch/api/v1/"
# headers = {'API-KEY': api_key}
post_data = {"query": "get_taginfo",
             "tag":"coinminer", "limit":"400", "type":"exe"}

# Make the API request
response = requests.post(url, data=post_data, )
name = "file_"


# Check if the request was successful
if response.status_code == 200:
    res_type = response.headers['content-type']
    if res_type == 'application/json':
        data = response.json()
        hashes = [x['sha256_hash'] for x in data['data']]
    
    for i,hash in enumerate(hashes):
        post_data2 = {"query": "get_file",
                        "sha256_hash": str(hash)}
        response = requests.post(url, data=post_data2)
        res_type = response.headers['content-type']
        if res_type == 'application/json':
            data = response.json()
            print(data)
        if res_type == 'application/zip':
            with open(f"./anyrun_miners/{name}{i}.zip", "wb") as f:
                f.write(response.content)
                print("Zip file successfully downloaded.")
    
else:
    # Handle the error
    print("Request failed with status code:", response.status_code)